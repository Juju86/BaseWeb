////////////////////////////////////////////////////////////////////////////////
// Grid
////////////////////////////////////////////////////////////////////////////////

////
// Columns
@grid_columns: 12;

////
// Grids
@grid_tablet_row_width: 720px; // 720px
@grid_tablet_gutter_width: 20px; // 20px

@grid_desktop_row_width: 960px; // 960px
@grid_desktop_gutter_width: 20px; // 20px

@grid_large_row_width: 1200px; // 1200px
@grid_large_gutter_width: 20px; // 20px

////
// Base Grid - Used when media queries are disabled
@grid_row_width: @grid_desktop_row_width;
@grid_gutter_width: @grid_desktop_gutter_width;

////
// Fluid Variables
@grid_min_width: @media_mobile;
@grid_max_width: 1200px;
@grid_margin_width: 20px;

////
// Grid Gutter Property
// Set to margin or padding
@grid_gutter_property: margin;

////
// Class variables
@class_container: container;
@class_row: row;
@class_column: col-;
@class_prefix: prefix-;
@class_suffix: suffix-;

@class_first: alpha;
@class_last: omega;

////
// Build selectors
@all_columns: ~'[class*="@{class_column}"]'; //escaped value interpolation

////
// Utility Variables - Should never be changed
@grid_column_width: (( @grid_row_width / @grid_columns  ) - @grid_gutter_width );
@grid_margin_switch: (@grid_max_width + (@grid_margin_width * 2));

////////////////////////////////////////////////////////////////////////////////
// Grid Mixins
////////////////////////////////////////////////////////////////////////////////

////
// Gutters
.gutters(@g) {
    margin-left: auto;
    margin-right: auto;
}
.gutters(@g) when (@grid_gutter_property = margin) {
    margin-left: @g;
    margin-right: @g;
}
.gutters(@g) when (@grid_gutter_property = padding) {
    padding-left: @g;
    padding-right: @g;
}
////
// Gutters First
.nested-gutters-first(@g) when (@grid_gutter_property = margin) {                    
    &:first-child, &.@{class_first} {
        margin-left: @g;
    }
}
.nested-gutters-first(@g) when (@grid_gutter_property = padding) {                    
    &:first-child, &.@{class_first} {
        padding-left: @g;
    }
}
////
// Gutters Last
.nested-gutters-last(@g) when (@grid_gutter_property = margin) {                    
    &:last-child, &.@{class_last} {
        margin-right: @g;
    }
}
.nested-gutters-last(@g) when (@grid_gutter_property = padding) {                    
    &:last-child, &.@{class_last} {
        padding-right: @g;
    }
}
////
// Gutters First Right
.nested-gutters-first-right(@g) when (@grid_gutter_property = margin) {                    
    &:first-child, &.@{class_first} {
        margin-right: @g;
    }
}
.nested-gutters-first-right(@g) when (@grid_gutter_property = padding) {                    
    &:first-child, &.@{class_first} {
        padding-right: @g;
    }
}
////
// Gutters Last Left
.nested-gutters-last-left(@g) when (@grid_gutter_property = margin) {                    
    &:last-child, &.@{class_last} {
        margin-left: @g;
    }
}
.nested-gutters-last-left(@g) when (@grid_gutter_property = padding) {                    
    &:last-child, &.@{class_last} {
        padding-left: @g;
    }
}

////////////////////////////////////////////////////////////////////////////////
// Base Grid Styles
////////////////////////////////////////////////////////////////////////////////

.@{class_container} {
    width: auto;
    .gutters(@grid_margin_width);
    .clearfix();
}
.@{class_row} {
    .clearfix();
}
@{all_columns} {
    // Prevent columns from collapsing when empty
    min-height: 1px;
}

////////////////////////////////////////////////////////////////////////////////
// The Grid Builder
////////////////////////////////////////////////////////////////////////////////

#grid_system( @grid_row_width, @grid_gutter_width ) {
    
    ////
    // Global
    .global() {
        
        ////
        // Set column width
        @grid_column_width: (( @grid_row_width / @grid_columns  ) - @grid_gutter_width );
        
        ////
        // Column Builder
        .col-X (@index) when (@index > 0) {
            .@{class_column}@{index} { .col-(@index); }
            .col-X(@index - 1);
        }
        .col- (@columns) {
            width: (@grid_column_width * @columns) + (@grid_gutter_width * (@columns - 1));
        }
        .col-X (@grid_columns);
        
        ////
        // Prefix Builder
        .pre-X (@index) when (@index > 0) {
            .@{class_prefix}@{index} { .pre-(@index); }
            .pre-X(@index - 1);
        }
        .pre- (@columns) {
            padding-left: (@grid_column_width * @columns) + (@grid_gutter_width * @columns);
        }
        .pre-X (@grid_columns);
        
        ////
        // Suffix Builder
        .suf-X (@index) when (@index > 0) {
            .@{class_suffix}@{index} { .suf-(@index); }
            .suf-X(@index - 1);
        }
        .suf- (@columns) {
            padding-right: (@grid_column_width * @columns) + (@grid_gutter_width * @columns);
        }
        .suf-X (@grid_columns);
        
        ////
        // Base
        @{all_columns} {
            float: left;
            .gutters( ( @grid_gutter_width / 2 ) );
        }
        
        ////
        // Nested Columns
        .@{class_row} .@{class_row} @{all_columns} {
            .nested-gutters-first(0);
            .nested-gutters-last(0);
        }
        
    } // End of .global();
    ////
    // Static
    .static() {
    
        ////
        // Load global styles
        .global();
        
        ////
        // Static Styles
        .@{class_container} {
            margin-left: auto;
            margin-right: auto;
            width: @grid_row_width;
            max-width: none;
        }
        
        ////
        // Nested Columns
        .@{class_row} .@{class_row} @{all_columns} {
            .nested-gutters-first-right( ( @grid_gutter_width / 2 ) );
            .nested-gutters-last-left( ( @grid_gutter_width / 2 ) );
        }
        
    } // End of .static();
    ////
    // Fluid
    .fluid() {
    
        ////
        // Load global styles
        .global();
        
        ////
        // Fluid Styles
        .@{class_container} {
            .gutters(@grid_margin_width);
            width: auto;
            max-width: @grid_max_width;
            @media (min-width: @grid_margin_switch) {
                margin-left: auto;
                margin-right: auto;
            }
        }
        
        ////
        // Nested Columns
        .@{class_row} .@{class_row} @{all_columns} {
            .nested-gutters-first-right( @grid_gutter_width );
            .nested-gutters-last-left( @grid_gutter_width );
        }
        
    } // End of .fluid();
    
    ////
    // Guarded Mixins
    .build() when ( ispixel(@grid_row_width) ) {
        .static();
    }
    .build() when ( ispercentage(@grid_row_width) ) {
        .fluid();
    }
    ////
    // Build Styles
    .build();
    
}

////////////////////////////////////////////////////////////////////////////////
// Semantic Grid System
////////////////////////////////////////////////////////////////////////////////

////
// Semantic Container
.container() {
    width: auto;
    .gutters(@grid_margin_width);
    .clearfix();
}

////
// Semantic Row
.row( @columns : @grid_columns ) {
    .clearfix();
}

////
// Semantic Column
.make-column( @col, @total_width, @gutter_width ) {
    // Get column width
    @column_width: (( @total_width / @columns  ) - @gutter_width );
    
    // Styles
    float: left;
    width: (@column_width * @col) + (@gutter_width * (@col - 1));
    .gutters( ( @gutter_width / 2 ) );
}
.column( @col, @columns : @grid_columns ) {
    min-height: 1px;
    
    @media screen and ( min-width: @media_tablet_min ) {
        .make-column( @col, @grid_tablet_row_width, @grid_tablet_gutter_width );
    }
    @media screen and ( min-width: @media_desktop_min ) {
        .make-column( @col, @grid_desktop_row_width, @grid_desktop_gutter_width );
    }
    @media screen and ( min-width: @media_large ) {
        .make-column( @col, @grid_large_row_width, @grid_large_gutter_width );
    }
}

////
// Semantic Prefix
.make-prefix( @col, @total_width, @gutter_width ) {
    // Get column width
    @column_width: (( @total_width / @columns  ) - @gutter_width );
    // Styles
    padding-left: (@column_width * @col) + (@gutter_width * @col);
}
.prefix( @offset : 1, @columns : @grid_columns ) {
    @media screen and ( min-width: @media_tablet_min ) {
        .make-prefix( @offset, @grid_tablet_row_width, @grid_tablet_gutter_width );
    }
    @media screen and ( min-width: @media_desktop_min ) {
        .make-prefix( @offset, @grid_desktop_row_width, @grid_desktop_gutter_width );
    }
    @media screen and ( min-width: @media_large ) {
        .make-prefix( @offset, @grid_large_row_width, @grid_large_gutter_width );
    }
}

////
// Semantic Suffix
.make-suffix( @col, @total_width, @gutter_width ) {
    // Get column width
    @column_width: (( @total_width / @columns  ) - @gutter_width );
    // Styles
    padding-right: (@column_width * @col) + (@gutter_width * @col);
}
.suffix( @offset : 1, @columns : @grid_columns ) {
    @media screen and ( min-width: @media_tablet_min ) {
        .make-suffix( @offset, @grid_tablet_row_width, @grid_tablet_gutter_width );
    }
    @media screen and ( min-width: @media_desktop_min ) {
        .make-suffix( @offset, @grid_desktop_row_width, @grid_desktop_gutter_width );
    }
    @media screen and ( min-width: @media_large ) {
        .make-suffix( @offset, @grid_large_row_width, @grid_large_gutter_width );
    }
}

////
// Alpha
.alpha() {
    .remove-gutter(0) when (@grid_gutter_property = margin) {                    
        margin-left: 0 !important;
    }
    .remove-gutter(0) when (@grid_gutter_property = padding) {                    
        padding-left: 0 !important;
    }
    .remove-gutter(0);
}

////
// Omega
.omega() {
    .remove-gutter(0) when (@grid_gutter_property = margin) {                    
        margin-right: 0 !important;
    }
    .remove-gutter(0) when (@grid_gutter_property = padding) {                    
        padding-right: 0 !important;
    }
    .remove-gutter(0);
}

////////////////////////////////////////////////////////////////////////////////
// Grid System Assignment
////////////////////////////////////////////////////////////////////////////////

#responsive {
    .base() {
        #grid_system( @grid_desktop_row_width, @grid_desktop_gutter_width );
    }
    .small() {

    }
    .mobile() {

    }
    .tablet() {
        #grid_system( @grid_tablet_row_width, @grid_tablet_gutter_width );
    }
    .desktop() {
        #grid_system( @grid_desktop_row_width, @grid_desktop_gutter_width );
    }
    .large() {
        #grid_system( @grid_large_row_width, @grid_large_gutter_width );
    }
}